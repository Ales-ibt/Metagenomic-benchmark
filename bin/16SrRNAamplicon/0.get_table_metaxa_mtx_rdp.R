#!/usr/bin/env Rscript
#  0.get_table_metaxa_mtx_rdp.R
#  Copyright 2017- E. Ernestina Godoy Lozano (tinagodoy@gmail.com)
#
#  This program is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 2 of the License, or
#  (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with this program; if not, write to the Free Software
#  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
#  MA 02110-1301, USA.
#
################################################################################
#### get reads_ranking.txt from METAXA2 results with MTX databases for setA ####
################################################################################
args = commandArgs(trailingOnly=TRUE)
directory_table=args[1]
directory_table2=args[2]

##Sacar el nombre de la ultima clasificacion taxonomica
tabla_new<- read.delim("classification_mod.txt", header=F)
colnames(tabla_new)<- c("reads_id","classification","score")
tabla_new$last.class<- sapply(as.character(tabla_new$classification), function(x){strsplit(x, ";")[[1]][length(strsplit(x, ";")[[1]])]})
tabla_new$last.class<- as.character(tabla_new$last.class)

tabla_new$last.class[which(tabla_new$last.class=="Pectobacterium sp. carotovorum")]<- "Pectobacterium carotovorum"
tabla_new$last.class[which(tabla_new$last.class=="Actinobacillus parahaemolyticus")]<- "Actinobacillus"
tabla_new$last.class[which(tabla_new$last.class=="Streptomyces sp. OS3 95")]<- "Streptomyces"
tabla_new$last.class[which(tabla_new$last.class=="Chloroplast")]<- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Koribacteraceae")]<- "Coriobacteriaceae"
tabla_new$last.class[which(tabla_new$last.class=="Vibrio sp. 27")]<- "Vibrio"
tabla_new$last.class[which(tabla_new$last.class=="NS5")] <- "Flavobacteriaceae"
tabla_new$last.class[which(tabla_new$last.class=="Brenneria sp. MK09")] <- "Brenneria"
tabla_new$last.class[which(tabla_new$last.class=="OPB56")] <- "Chlorobi"
tabla_new$last.class[which(tabla_new$last.class=="Ellin515")] <- "Verrucomicrobia"
tabla_new$last.class[which(tabla_new$last.class=="SHA 20")] <- "Anaerolineae"
tabla_new$last.class[which(tabla_new$last.class=="Stigonema sp. UAM 342")] <- "Stigonema"
tabla_new$last.class[which(tabla_new$last.class=="RB25")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Pir4")] <- "Planctomycetaceae"
tabla_new$last.class[which(tabla_new$last.class=="OM60")] <- "Halieaceae"
tabla_new$last.class[which(tabla_new$last.class=="YS2")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Sva0725")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="SC I 84")] <- "Betaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Erwinia dispersa")] <- "Erwinia"
tabla_new$last.class[which(tabla_new$last.class=="Sporichthyaceae hgcI")] <- "Sporichthyaceae"
tabla_new$last.class[which(tabla_new$last.class=="RB41")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Thiohalorhabdales")] <- "Gammaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Spirobacillales")] <- "Gammaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Piscirickettsiaceae endosymbionts")] <- "Piscirickettsiaceae"
tabla_new$last.class[which(tabla_new$last.class=="Pseudanabaenales")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="HTCC")] <- "Alteromonadales"
tabla_new$last.class[which(tabla_new$last.class=="HTCC2188")] <- "Alteromonadales"
tabla_new$last.class[which(tabla_new$last.class=="EC1113")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="DS 18")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Desulfotomaculum Desulfovirgula")] <- "Desulfotomaculum"
tabla_new$last.class[which(tabla_new$last.class=="TM1")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Pseudanabaenales")] <- "Synechococcales"
tabla_new$last.class[which(tabla_new$last.class=="Neisseria flava mucosa pharyngis")] <- "Neisseria pharyngis subsp. flava"
tabla_new$last.class[which(tabla_new$last.class=="Marinilabiaceae")] <- "Marinilabiliaceae"
tabla_new$last.class[which(tabla_new$last.class=="GIF9")] <- "Dehalococcoidia"
tabla_new$last.class[which(tabla_new$last.class=="Dehalobacter Syntrophob")] <- "Dehalobacter"
tabla_new$last.class[which(tabla_new$last.class=="CCU21")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="0319 7L14")] <- "Actinobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Candidatus Nostocoida")] <- "Planctomycetaceae"
tabla_new$last.class[which(tabla_new$last.class=="BD1 7")] <- "Spongiibacteraceae"
tabla_new$last.class[which(tabla_new$last.class=="VE39G03")] <- "Aeromonas"
tabla_new$last.class[which(tabla_new$last.class=="Acidobacteria iii1 15")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="S24 7")] <- "Bacteroidales"
tabla_new$last.class[which(tabla_new$last.class=="Lineage I")] <- "Elusimicrobia"
tabla_new$last.class[which(tabla_new$last.class=="Kaistobacter")] <- "Sphingomonas"
tabla_new$last.class[which(tabla_new$last.class=="Ruminococcaceae Group")] <- "Ruminococcaceae"
tabla_new$last.class[which(tabla_new$last.class=="Halobacteriaceae Group")] <- "Halobacteriaceae"
tabla_new$last.class[which(tabla_new$last.class=="Chloracidobacteria")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="BPC102")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Verruco 5")] <- "Verrucomicrobia"
tabla_new$last.class[which(tabla_new$last.class=="Marinilabiaceae")] <- "Marinilabiliaceae"
tabla_new$last.class[which(tabla_new$last.class=="Trabulsiella farmeri")] <- "Trabulsiella"
tabla_new$last.class[which(tabla_new$last.class=="iii1 15")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="WS3")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="Sediment 1")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="SBR1031")] <- "Anaerolineae"
tabla_new$last.class[which(tabla_new$last.class=="Thiohalorhabdales")] <- "Gammaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="SubsectionI")] <- "Oscillatoriophycideae"
tabla_new$last.class[which(tabla_new$last.class=="Pedosphaerae")] <- "Pedosphaera"
tabla_new$last.class[which(tabla_new$last.class=="Cloacamonae")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="koll11")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="Pirellulales")] <- "Planctomycetacia"
tabla_new$last.class[which(tabla_new$last.class=="TG3")] <- "Fibrobacteres"
tabla_new$last.class[which(tabla_new$last.class=="AB16")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="Escherichia Shigella")] <- "Escherichia"
tabla_new$last.class[which(tabla_new$last.class=="Escherichia-Shigella")] <- "Escherichia"
tabla_new$last.class[which(tabla_new$last.class=="Escherichia-Shigella bacterium ZH-4")] <- "bacterium ZH-4"
tabla_new$last.class[which(tabla_new$last.class=="Acetothermia uncultured bacterium")] <- "uncultured Acetothermia bacterium"
tabla_new$last.class[which(tabla_new$last.class=="AEGEAN-169 marine group")] <- "Rhodospirillaceae"
tabla_new$last.class[which(tabla_new$last.class=="Hahella unidentified")] <- "Hahella"
tabla_new$last.class[which(tabla_new$last.class=="Sulfurimonas uncultured bacterium")] <- "Sulfurimonas"
tabla_new$last.class[which(tabla_new$last.class=="Helicobacter uncultured bacterium")] <- "Helicobacter"
tabla_new$last.class[which(tabla_new$last.class=="Candidatus Methylacidiphilum")] <- "Methylacidiphilum"
tabla_new$last.class[which(tabla_new$last.class=="Thioalkalimicrobium gamma proteobacterium ASL1")] <- "Thioalkalimicrobium"
tabla_new$last.class[which(tabla_new$last.class=="Prevotella 7")] <- "Prevotella"
tabla_new$last.class[which(tabla_new$last.class=="Roseiflexus hot springs metagenome")] <- "Roseiflexus"
tabla_new$last.class[which(tabla_new$last.class=="FamilyI")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Chloroflexus unidentified")] <- "Chloroflexus"
tabla_new$last.class[which(tabla_new$last.class=="Candidatus Atelocyanobacterium (UCYN-A)")] <- "cyanobacterium UCYN-A"
tabla_new$last.class[which(tabla_new$last.class=="Leptospirillum uncultured bacterium")] <- "Leptospirillum"
tabla_new$last.class[which(tabla_new$last.class=="Prevotella 1")] <- "Prevotella"
tabla_new$last.class[which(tabla_new$last.class=="SubsectionIV")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Desulfobacterium delta proteobacterium 8aA2")] <- "Desulfobacterium"
tabla_new$last.class[which(tabla_new$last.class=="Candidatus Liberibacter")] <- "Candidatus Liberobacter"
tabla_new$last.class[which(tabla_new$last.class=="[Cellvibrio] gilvus ATCC 13127")] <- "Cellulomonas gilvus ATCC 13127"
tabla_new$last.class[which(tabla_new$last.class=="Caldicellulosiruptor kristjanssonii 177R1B")] <- "Caldicellulosiruptor kristjanssonii"
tabla_new$last.class[which(tabla_new$last.class=="Ilumatobacter actinobacterium YM22-133")] <- "Ilumatobacter"
tabla_new$last.class[which(tabla_new$last.class=="marine group cyanobacterium UCYN-A")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Incertae Sedis")] <- "Lachnospiraceae"
tabla_new$last.class[which(tabla_new$last.class=="Thioalkalivibrio gamma proteobacterium ASL10")] <- "Thioalkalivibrio"
tabla_new$last.class[which(tabla_new$last.class=="unclassified Iamiaceae")] <- "Iamiaceae"
tabla_new$last.class[which(tabla_new$last.class=="unclassified Bifidobacteriaceae")] <- "Bifidobacteriaceae"
tabla_new$last.class[which(tabla_new$last.class=="Bacteria Outgroup")] <- "Archaea"
tabla_new$last.class[which(tabla_new$last.class=="Akkermansia_muciniphila")] <- "Akkermansia muciniphila"
tabla_new$last.class[which(tabla_new$last.class=="Acinetobacter_rhizosphaerae")] <- "Acinetobacter rhizosphaerae"
tabla_new$last.class[which(tabla_new$last.class=="Psychroflexus_torquis")] <- "Psychroflexus torquis"
tabla_new$last.class[which(tabla_new$last.class=="Prevotella_melaninogenica")] <- "Prevotella melaninogenica"
tabla_new$last.class[which(tabla_new$last.class=="Bacteroides_fragilis")] <- "Bacteroides fragilis"
tabla_new$last.class[which(tabla_new$last.class=="Acinetobacter_lwoffii")] <- "Acinetobacter lwoffii"
tabla_new$last.class[which(tabla_new$last.class=="Neisseria_cinerea")] <- "Neisseria cinerea"
tabla_new$last.class[which(tabla_new$last.class=="Candidatus_Methylacidiphilum_infernorum")] <- "Methylacidiphilum infernorum"
tabla_new$last.class[which(tabla_new$last.class=="Fervidomicrobium")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="Paludimonas")] <- "Paludibacterium"
tabla_new$last.class[which(tabla_new$last.class=="Puniceibacter")] <- "Puniceicoccus"
tabla_new$last.class[which(tabla_new$last.class=="Flavobacteria")] <- "Flavobacteriia"
tabla_new$last.class[which(tabla_new$last.class=="Aquasalina")] <- "Aquisalimonas"
tabla_new$last.class[which(tabla_new$last.class=="Methylonatronum")] <- "Methylonatrum"
tabla_new$last.class[which(tabla_new$last.class=="unclassified Ktedobacteria")] <- "unclassified Ktedonobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Chinabacter")] <- "Cytophagaceae"
tabla_new$last.class[which(tabla_new$last.class=="Solibium")] <- "Gammaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Gulbenkianus")] <- "Gulbenkiania"
tabla_new$last.class[which(tabla_new$last.class=="Antarctic")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="Desulfitobacter")] <- "Desulfitibacter"
tabla_new$last.class[which(tabla_new$last.class=="Endozoicimonas")] <- "Endozoicomonas"
tabla_new$last.class[which(tabla_new$last.class=="Kaistina")] <- "Kaistia"
tabla_new$last.class[which(tabla_new$last.class=="Chrysemys picta ")] <- "Chrysemys picta"
tabla_new$last.class[which(tabla_new$last.class=="Mitochondria")] <- "Eukaryota"
tabla_new$last.class[which(tabla_new$last.class=="34P16")] <- "Gammaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="CF2")] <- "Proteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Hafnia-Obesumbacterium")] <- "Enterobacteriaceae"
tabla_new$last.class[which(tabla_new$last.class=="Quinella ovalis ")] <- "Quinella ovalis"
tabla_new$last.class[which(tabla_new$last.class=="Streptomyces sp. 5340")] <- "Streptomyces sp."
tabla_new$last.class[which(tabla_new$last.class=="FamilyII")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="'Nostoc")] <- "Nostoc"
tabla_new$last.class[which(tabla_new$last.class=="SubgroupI")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="SubsectionIII")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="SubsectionII")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Family Incertae Sedis")] <- "Dehalococcoidetes"
tabla_new$last.class[which(tabla_new$last.class=="Candidatus")] <- "Candidatus Liberobacter"
tabla_new$last.class[which(tabla_new$last.class=="bacterium LA14E")] <- "Enterobacter sp. LA14E"
tabla_new$last.class[which(tabla_new$last.class=="Nocardiopsis sp. 20028")] <- "Nocardiopsis valliformis DSM 45023"
tabla_new$last.class[which(tabla_new$last.class=="Rickettsia akari ")] <- "Rickettsia akari"
tabla_new$last.class[which(tabla_new$last.class=="Rubrobacteriaceae")] <- "Rubrobacteraceae"
tabla_new$last.class[which(tabla_new$last.class=="Salmonella enterica subsp. enterica serovar Gallinarum/pullorum str.")] <- "Salmonella enterica subsp. enterica serovar Gallinarum var. Pullorum str. 76059"
tabla_new$last.class[which(tabla_new$last.class=="Streptomyces sp. 08-40-02-1")] <- "Streptomyces sp."
tabla_new$last.class[which(tabla_new$last.class=="Chloroplast")] <- "Eukaryota"
tabla_new$last.class[which(tabla_new$last.class=="Bacillus amyloliquefaciens CAU-B946")] <- "Bacillus velezensis CAU B946"
tabla_new$last.class[which(tabla_new$last.class=="Nostocaceae cyanobacterium SAG B11.82")] <- "Cylindrospermum siamensis SAG 11.82"
tabla_new$last.class[which(tabla_new$last.class=="Synechococcus sp. JA-2-3B'a")] <- "Synechococcus sp."
tabla_new$last.class[which(tabla_new$last.class=="Unknown Eukaryote")] <- "Eukaryota"
tabla_new$last.class[which(tabla_new$last.class=="Acidopila rosea")] <- "Acidipila rosea"
tabla_new$last.class[which(tabla_new$last.class=="Ketogulonigenium vulgarum WSH-001")] <- "Ketogulonicigenium vulgare WSH-001"
tabla_new$last.class[which(tabla_new$last.class=="Klebsiella sp. ICB365")] <- "Klebsiella sp. ICB 365"
tabla_new$last.class[which(tabla_new$last.class=="Order Incertae Sedis")] <- "Gammaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Sinorhizobium sp. bD51")] <- "Sinorhizobium sp."
tabla_new$last.class[which(tabla_new$last.class=="Ehrlichia ruminantium ")] <- "Ehrlichia ruminantium"
tabla_new$last.class[which(tabla_new$last.class=="Methanobacterium sp. SWAN-1")] <- "Methanobacterium paludis"
tabla_new$last.class[which(tabla_new$last.class=="Acidobacteria_Gp1")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Acidobacteria_Gp1_Gp1")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Acidobacteria_Gp3")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Acidobacteria_Gp3_Gp3")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Acidobacteria_Gp4")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Acidobacteria_Gp4_Gp4")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Bacillaceae 1")] <- "Bacillaceae"
tabla_new$last.class[which(tabla_new$last.class=="Bacillaceae 1 1")] <- "Bacillaceae"
tabla_new$last.class[which(tabla_new$last.class=="Burkholderiales_incertae_sedis_incertae_sedis")] <- "Burkholderiales"
tabla_new$last.class[which(tabla_new$last.class=="Clostridiaceae 1")] <- "Clostridiaceae"
tabla_new$last.class[which(tabla_new$last.class=="Clostridiaceae 1 1")] <- "Clostridiaceae"
tabla_new$last.class[which(tabla_new$last.class=="Clostridium sensu stricto")] <- "Clostridium"
tabla_new$last.class[which(tabla_new$last.class=="Clostridium XI")] <- "Clostridium"
tabla_new$last.class[which(tabla_new$last.class=="Clostridium XlVa")] <- "Clostridium"
tabla_new$last.class[which(tabla_new$last.class=="Cyanobacteria/Chloroplast")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Escherichia/Shigella")] <- "Escherichia"
tabla_new$last.class[which(tabla_new$last.class=="Family I")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Family IX")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Gp1")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Gp21")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Gp3")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Gp6")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="GpI")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="GpIIa")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="GpIIb")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="GpIV")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="GpIX")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="GpVI")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="GpVII")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="GpX")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="GpXI")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="GpXII")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="GpXIII")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Paenibacillaceae 1")] <- "Paenibacillaceae"
tabla_new$last.class[which(tabla_new$last.class=="Paenibacillaceae 1 1")] <- "Paenibacillaceae"
tabla_new$last.class[which(tabla_new$last.class=="Peptococcaceae 1")] <- "Peptococcaceae"
tabla_new$last.class[which(tabla_new$last.class=="Peptococcaceae 2 2")] <- "Peptococcaceae"
tabla_new$last.class[which(tabla_new$last.class=="Sporolactobacillaceae_incertae_sedis")] <- "Sporolactobacillaceae"
tabla_new$last.class[which(tabla_new$last.class=="subclass")] <- "Actinobacteria"
tabla_new$last.class[which(tabla_new$last.class=="suborder")] <- "Actinobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Unknown Metazoa")] <- "Eukaryota"
tabla_new$last.class[which(tabla_new$last.class=="Family II")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Family IV")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Lachnospiracea_incertae_sedis")] <- "Lachnospiraceae"
tabla_new$last.class[which(tabla_new$last.class=="Latescibacteria_genera_incertae_sedis")] <- "Candidatus Latescibacteria"
tabla_new$last.class[which(tabla_new$last.class=="Peptococcaceae 1 1")] <- "Peptococcaceae"
tabla_new$last.class[which(tabla_new$last.class=="Family VII")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Peptococcaceae 2")] <- "Peptococcaceae"
tabla_new$last.class[which(tabla_new$last.class=="Cyanobacteria/Chloroplast/Chloroplast")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Acidobacteria>")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Alcaligenes>")] <- "Alcaligenes"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Bacillus>")] <- "Bacillus"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <beta subdivision>")] <- "Betaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Chloroflexus>")] <- "Chloroflexus"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Cyanobacteria>")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Dehalococcoides>")] <- "Dehalococcoides"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Flavobacterium>")] <- "Flavobacterium"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Flexibacter>")] <- "Flexibacter"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Pediococcus>")] <- "Pediococcus"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Planctomycetales>")] <- "Planctomycetales"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Serratia>")] <- "Serratia"
tabla_new$last.class[which(tabla_new$last.class=="Rhizobium sp. Cap K13")] <- "Rhizobium sp."
tabla_new$last.class[which(tabla_new$last.class=="unclassified Alphaproteobacteria ")] <- "unclassified Alphaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="unclassified Bacteria ")] <- "unclassified Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="unclassified Gammaproteobacteria ")] <- "unclassified Gammaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Coxiella <Bacteria>")] <- "Coxiella"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Bacteria>")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="Rhodococcus <Bacteria>")] <- "Rhodococcus"
tabla_new$last.class[which(tabla_new$last.class=="Citrobacter sp. FDAARGOS 156")] <- "Citrobacter sp."
tabla_new$last.class[which(tabla_new$last.class=="Dehalococcoides sp. JN18 A96 B*")] <- "Dehalococcoides sp."
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Alteromonas>")] <- "Alteromonas"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <gamma proteobacteria>")] <- "Gammaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <unclassified>")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="Mycobacterium avium complex ")] <- "Mycobacterium avium complex"
tabla_new$last.class[which(tabla_new$last.class=="Rhizobium sp. R9 Dewas")] <- "Rhizobium sp."
tabla_new$last.class[which(tabla_new$last.class=="Solanum melongena ")] <- "Solanum melongena"
tabla_new$last.class[which(tabla_new$last.class=="Streptomyces sp. GBA 94-11")] <- "Streptomyces sp."
tabla_new$last.class[which(tabla_new$last.class=="Vertebrata <Metazoa>")] <- "Metazoa"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Acetobacterium>")] <- "Acetobacterium"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Algoriphagus>")] <- "Algoriphagus"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Archaea>")] <- "Archaea"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Chlorobaculum>")] <- "Chlorobaculum"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Roseiflexus>")] <- "Roseiflexus"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Selenomonas>")] <- "Selenomonas"
tabla_new$last.class[which(tabla_new$last.class=="Geobacillus subterraneus subsp. subterraneus")] <- "Geobacillus subterraneus"
tabla_new$last.class[which(tabla_new$last.class=="Acidobacteria-6 iii1-15")] <- "Acidobacteriia"
tabla_new$last.class[which(tabla_new$last.class=="ACK-M1")] <- "Actinomycetales"
tabla_new$last.class[which(tabla_new$last.class=="Anaerolinaceae")] <- "Anaerolineaceae"
tabla_new$last.class[which(tabla_new$last.class=="BD7-3")] <- "Alphaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Bosea genosp.")] <- "Bosea"
tabla_new$last.class[which(tabla_new$last.class=="C111")] <- "Acidimicrobiales"
tabla_new$last.class[which(tabla_new$last.class=="Dehalobacter Syntrophobotulus")] <- "Dehalobacter"
tabla_new$last.class[which(tabla_new$last.class=="Desulfotomaculum Desulfovirgula")] <- "Desulfotomaculum"
tabla_new$last.class[which(tabla_new$last.class=="Gemellaceae")] <- "Bacillales"
tabla_new$last.class[which(tabla_new$last.class=="Gemmatales")] <- "Planctomycetia"
tabla_new$last.class[which(tabla_new$last.class=="ML635J-21")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Nostocophycideae")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Phormidiaceae")] <- "Oscillatoriales"
tabla_new$last.class[which(tabla_new$last.class=="Pirellulaceae")] <- "Planctomycetia"
tabla_new$last.class[which(tabla_new$last.class=="SBla14")] <- "Betaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="SM1A07")] <- "Bacteroidetes"
tabla_new$last.class[which(tabla_new$last.class=="Streptococcus luteciae")] <- "Streptococcus lutetiensis"
tabla_new$last.class[which(tabla_new$last.class=="Synechococcophycideae")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Thiobacterales")] <- "Betaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Agrobacterium sullae")] <- "Agrobacterium"
tabla_new$last.class[which(tabla_new$last.class=="Anaerolineae envOPS12")] <- "Anaerolineae"
tabla_new$last.class[which(tabla_new$last.class=="CK-1C4-19")] <- "Tenericutes"
tabla_new$last.class[which(tabla_new$last.class=="GCA004")] <- "Anaerolineae"
tabla_new$last.class[which(tabla_new$last.class=="ML635J-40")] <- "Bacteroidales"
tabla_new$last.class[which(tabla_new$last.class=="T78")] <- "Anaerolineaceae"
tabla_new$last.class[which(tabla_new$last.class=="Thiohalorhabdaceae")] <- "Gammaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="WCHB1-41")] <- "Verrucomicrobia"
tabla_new$last.class[which(tabla_new$last.class=="[Weeksellaceae]")] <- "Flavobacteriales"
tabla_new$last.class[which(tabla_new$last.class=="ZD0117")] <- "Alteromonadaceae"
tabla_new$last.class[which(tabla_new$last.class=="AKIW874")] <- "Acidimicrobiales"
tabla_new$last.class[which(tabla_new$last.class=="[Chlorothrixaceae]")] <- "Chloroflexales"
tabla_new$last.class[which(tabla_new$last.class=="Ellin329")] <- "Alphaproteobacteria"
tabla_new$last.class[which(tabla_new$last.class=="HMMVPog-54")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="iii1-15 mb2424")] <- "Acidobacteria"
tabla_new$last.class[which(tabla_new$last.class=="[Micrarchaeles]")] <- "Candidatus Parvarchaeota"
tabla_new$last.class[which(tabla_new$last.class=="MSB-1E9")] <- "Anaerolineae"
tabla_new$last.class[which(tabla_new$last.class=="MVS-65")] <- "Solibacterales"
tabla_new$last.class[which(tabla_new$last.class=="NKB19")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="OP8 1")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="SBYO 3720")] <- "Chloroflexales"
tabla_new$last.class[which(tabla_new$last.class=="SJA-4")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="Sporosarcina ginsengi")] <- "Sporosarcina"
tabla_new$last.class[which(tabla_new$last.class=="Stenotrophomonas geniculata")] <- "Stenotrophomonas"
tabla_new$last.class[which(tabla_new$last.class=="Dehalobacter_Syntrophobotulus")] <- "Dehalobacter"
tabla_new$last.class[which(tabla_new$last.class=="Desulfotomaculum_Desulfovirgula")] <- "Desulfotomaculum"
tabla_new$last.class[which(tabla_new$last.class=="Pseudanabaenales")] <- "Cyanobacteria"
tabla_new$last.class[which(tabla_new$last.class=="[Ruminococcus]")] <- "Ruminococcus"
tabla_new$last.class[which(tabla_new$last.class=="Burkholderiales_incertae_sedis")] <- "Burkholderiales"
tabla_new$last.class[which(tabla_new$last.class=="Clostridium IV")] <- "Clostridium"
tabla_new$last.class[which(tabla_new$last.class=="Frankineae suborder")] <- "Frankiales"
tabla_new$last.class[which(tabla_new$last.class=="Ruminococcus2")] <- "Ruminococcus"
tabla_new$last.class[which(tabla_new$last.class=="Actinobacteria <class>")] <- "Actinobacteria"
tabla_new$last.class[which(tabla_new$last.class=="Anabaena <cyanobacteria>")] <- "Anabaena"
tabla_new$last.class[which(tabla_new$last.class=="Bacillus <bacterium>")] <- "Bacillus"
tabla_new$last.class[which(tabla_new$last.class=="Bacteria <prokaryotes>")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="Bacteroidetes <phylum>")] <- "Bacteroidetes"
tabla_new$last.class[which(tabla_new$last.class=="Ehrlichia ruminantium (heartwater rickettsia)")] <- "Ehrlichia ruminantium"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Hyphomicrobium>")] <- "Hyphomicrobium"
tabla_new$last.class[which(tabla_new$last.class=="environmental samples <Marinobacter>")] <- "Marinobacter"
tabla_new$last.class[which(tabla_new$last.class=="Gemmatimonadetes <class>")] <- "Gemmatimonadetes"
tabla_new$last.class[which(tabla_new$last.class=="hydrothermal vent eubacterium PVB OTU 2")] <- "Bacteria"
tabla_new$last.class[which(tabla_new$last.class=="Chloroflexi <phylum>")] <- "Chloroflexi"
tabla_new$last.class[which(tabla_new$last.class=="Edwardsiella <enterobacteria>")] <- "Edwardsiella"

tabla_new2 <- data.frame(tabla_new$reads_id, tabla_new$classification, tabla_new$last.class, tabla_new$score)
write.table(tabla_new2,"otus_unicos_mod.txt", quote=F, col.names=T, row.names=F, sep="\t")
system(paste("python ", directory_table2, sep=""))

tabla<- read.delim("otus_unicos_taxid_mod.txt")
colnames(tabla)[2]<-"taxid"
tabla$taxid_limpio<- sapply(as.character(tabla$taxid), function(x){strsplit(strsplit(as.character(x), "[[]")[[1]][2], "[]]")[[1]][1]})

tabla$last_class_clean <- sapply(as.character(tabla$tabla_new.last.class), function(x){strsplit(x, " ")[[1]][1]})
dobles <- read.delim(directory_table, header=T)

for (j in 1:dim(dobles)[1]){
	num <- which(tabla$last_class_clean==dobles$last_class[j])
	tabla$taxid_limpio[num] <-dobles$taxid[j]
}

new<- data.frame(tabla$tabla_new.reads_id, tabla$taxid_limpio, tabla$tabla_new.score)
write.table(new, "reads_ranking.txt", sep="\t", quote=F, col.names=F, row.names=F)
